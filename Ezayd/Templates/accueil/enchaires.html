{% load static %}
<section class="auctions-section" aria-label="Ench√®res actives">
  <header class="section-header">
    <!-- Search Box et Filtres -->
    <div class="search-filter-container">
      <!-- Barre de recherche principale -->
      <div class="search-box-container">
        <form method="get" action="" class="search-form" role="search">
          <div class="search-input-wrapper">
            <input 
              type="text" 
              name="search" 
              id="live-search"
              class="search-input" 
              placeholder="Rechercher dans les ench√®res..." 
              value="{{ request.GET.search }}"
              aria-label="Rechercher dans les ench√®res"
              oninput="performLiveSearch(this.value)"
            >
            <button type="submit" class="search-btn" aria-label="Rechercher">
              <i class="fas fa-search" aria-hidden="true"></i>
            </button>
          </div>
        </form>
      </div>

      
      <!-- Boutons de filtres -->
      <div class="filter-buttons-container">
        <!-- Bouton Filtres -->
        <button class="filter-btn filter-btn-dark" onclick="toggleSidebar()">
          <i class="fas fa-sliders-h" aria-hidden="true"></i>
          Filtres
          <span id="filter-count" class="filter-count">0</span>
        </button>

        <!-- Bouton Trier -->
        <div class="filter-dropdown">
          <button class="filter-btn filter-btn-dark dropdown-btn" onclick="toggleDropdown('sort-dropdown')">
            <i class="fas fa-sort" aria-hidden="true"></i>
            TRIER
            <i class="fas fa-chevron-down dropdown-arrow" aria-hidden="true"></i>
          </button>
          <div id="sort-dropdown" class="dropdown-menu">
            <a href="?sort=price_asc" class="dropdown-item">Prix croissant</a>
            <a href="?sort=price_desc" class="dropdown-item">Prix d√©croissant</a>
            <a href="?sort=date_asc" class="dropdown-item">Date croissante</a>
            <a href="?sort=date_desc" class="dropdown-item">Date d√©croissante</a>
            <a href="?sort=popular" class="dropdown-item">Plus populaires</a>
          </div>
        </div>

        <!-- Bouton √âtat -->
        <div class="filter-dropdown">
          <button class="filter-btn filter-btn-dark dropdown-btn" onclick="toggleDropdown('status-dropdown')">
            <i class="fas fa-clock" aria-hidden="true"></i>
            √âTAT
            <i class="fas fa-chevron-down dropdown-arrow" aria-hidden="true"></i>
          </button>
          <div id="status-dropdown" class="dropdown-menu">
            <a href="javascript:void(0)" class="dropdown-item" onclick="filterByStatus('active')">üü¢ Actives</a>
            <a href="javascript:void(0)" class="dropdown-item" onclick="filterByStatus('upcoming')">üü° √Ä venir</a>
            <a href="javascript:void(0)" class="dropdown-item" onclick="filterByStatus('ended')">‚ö´ Termin√©es</a>
            <a href="javascript:void(0)" class="dropdown-item" onclick="filterByStatus('all')">Toutes</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Overlay pour fermer la sidebar -->
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <!-- Sidebar de filtres optimis√©e -->
    <div id="sidebar" class="sidebar">
      <div class="sidebar-header">
        <h3 class="sidebar-title">
          <i class="fas fa-filter"></i>
          Filtres
        </h3>
        <button class="close-btn" onclick="toggleSidebar()" aria-label="Fermer les filtres">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="sidebar-content">
        <!-- Cat√©gories compactes -->
        <div class="filter-group" data-filter="categories">
  <label class="filter-group-title">
    <i class="fas fa-tags"></i>
    Cat√©gories
  </label>
  <div class="category-dropdown-wrapper">
    <button class="category-dropdown-btn" onclick="toggleCategoryDropdown()">
      <span id="category-selected-text">Toutes les cat√©gories</span>
      <i class="fas fa-chevron-down category-dropdown-arrow"></i>
    </button>
    
    <div id="category-dropdown-menu" class="category-dropdown-menu">
      <div class="category-dropdown-content">
        <div class="category-dropdown-header">
          <span>S√©lectionnez les cat√©gories</span>
          <button class="category-clear-btn" onclick="clearCategorySelection(event)">Effacer</button>
        </div>
        <div class="category-dropdown-search">
          <input type="text" placeholder="Rechercher une cat√©gorie..." onkeyup="filterCategories(this.value)">
        </div>
        <div class="category-dropdown-items">
          <label class="category-dropdown-item">
            <input type="checkbox" name="category" value="vehicules" onchange="updateCategorySelection(this)">
            <span class="category-checkmark"></span>
            <span class="category-text">üöó V√©hicules</span>
          </label>
          <label class="category-dropdown-item">
            <input type="checkbox" name="category" value="immobilier" onchange="updateCategorySelection(this)">
            <span class="category-checkmark"></span>
            <span class="category-text">üè† Immobilier</span>
          </label>
          <label class="category-dropdown-item">
            <input type="checkbox" name="category" value="materiel_pro" onchange="updateCategorySelection(this)">
            <span class="category-checkmark"></span>
            <span class="category-text">üîß Mat√©riel professionnel</span>
          </label>
          <label class="category-dropdown-item">
            <input type="checkbox" name="category" value="informatique" onchange="updateCategorySelection(this)">
            <span class="category-checkmark"></span>
            <span class="category-text">üíª Informatique & √©lectronique</span>
          </label>
          <label class="category-dropdown-item">
            <input type="checkbox" name="category" value="mobilier" onchange="updateCategorySelection(this)">
            <span class="category-checkmark"></span>
            <span class="category-text">ü™ë Mobilier & √©quipements</span>
          </label>
          <label class="category-dropdown-item">
            <input type="checkbox" name="category" value="bijoux" onchange="updateCategorySelection(this)">
            <span class="category-checkmark"></span>
            <span class="category-text">üíé Bijoux & objets de valeur</span>
          </label>
          <label class="category-dropdown-item">
            <input type="checkbox" name="category" value="stocks" onchange="updateCategorySelection(this)">
            <span class="category-checkmark"></span>
            <span class="category-text">üì¶ Stocks et invendus</span>
          </label>
          <label class="category-dropdown-item">
            <input type="checkbox" name="category" value="oeuvres" onchange="updateCategorySelection(this)">
            <span class="category-checkmark"></span>
            <span class="category-text">üé® ≈íuvres & collections</span>
          </label>
        </div>
      </div>
    </div>
  </div>
</div>
        
        <!-- Date compacte -->
        <div class="filter-group" data-filter="date">
          <label class="filter-group-title">
            <i class="fas fa-calendar-alt"></i>
            P√©riode
          </label>
          <div class="select-wrapper-compact">
            <select id="date-filter" name="date_filter" class="styled-select-compact" onchange="updateFilters()">
              <option value="all">Toutes les dates</option>
              <option value="today">Aujourd'hui</option>
              <option value="week">Cette semaine</option>
              <option value="month">Ce mois-ci</option>
            </select>
          </div>
        </div>

        <!-- Localisation compacte -->
        <div class="filter-group" data-filter="wilaya">
  <label class="filter-group-title">
    <i class="fas fa-map-marker-alt"></i>
    Wilaya
  </label>
  <div class="wilaya-dropdown-wrapper">
    <button class="wilaya-dropdown-btn" onclick="toggleWilayaDropdown()">
      <span id="wilaya-selected-text">Toutes les wilayas</span>
      <i class="fas fa-chevron-down wilaya-dropdown-arrow"></i>
    </button>
    
    <div id="wilaya-dropdown-menu" class="wilaya-dropdown-menu">
      <div class="wilaya-dropdown-content">
        <div class="wilaya-dropdown-header">
          <span>S√©lectionnez les wilayas</span>
          <button class="wilaya-clear-btn" onclick="clearWilayaSelection(event)">Effacer</button>
        </div>
        <div class="wilaya-dropdown-search">
          <input type="text" placeholder="Rechercher une wilaya..." onkeyup="filterWilayas(this.value)">
        </div>
        <div class="wilaya-dropdown-items">
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="01" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Adrar</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="02" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Chlef</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="03" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Laghouat</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="04" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Oum El Bouaghi</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="05" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Batna</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="06" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">B√©ja√Øa</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="07" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Biskra</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="08" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">B√©char</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="09" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Blida</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="10" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Bouira</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="11" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Tamanrasset</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="12" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">T√©bessa</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="13" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Tlemcen</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="14" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Tiaret</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="15" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Tizi Ouzou</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="16" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Alger</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="17" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Djelfa</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="18" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Jijel</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="19" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">S√©tif</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="20" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Sa√Øda</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="21" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Skikda</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="22" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Sidi Bel Abb√®s</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="23" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Annaba</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="24" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Guelma</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="25" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Constantine</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="26" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">M√©d√©a</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="27" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Mostaganem</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="28" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">M'Sila</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="29" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Mascara</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="30" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Ouargla</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="31" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Oran</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="32" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">El Bayadh</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="33" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Illizi</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="34" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Bordj Bou Arr√©ridj</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="35" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Boumerd√®s</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="36" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">El Tarf</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="37" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Tindouf</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="38" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Tissemsilt</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="39" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">El Oued</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="40" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Khenchela</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="41" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Souk Ahras</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="42" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Tipaza</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="43" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Mila</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="44" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">A√Øn Defla</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="45" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Na√¢ma</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="46" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">A√Øn T√©mouchent</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="47" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Gharda√Øa</span>
          </label>
          <label class="wilaya-dropdown-item">
            <input type="checkbox" name="wilaya" value="48" onchange="updateWilayaSelection(this)">
            <span class="wilaya-checkmark"></span>
            <span class="wilaya-text">Relizane</span>
          </label>
        </div>
      </div>
    </div>
  </div>
</div>

        <!-- Boutons d'action compacts -->
        <div class="filter-actions-compact">
          <button class="filter-action-btn-compact secondary" onclick="clearAllFilters()">
            <i class="fas fa-eraser"></i>
            Effacer
          </button>
          <button class="filter-action-btn-compact primary" onclick="applyFilters()">
            <i class="fas fa-check"></i>
            Appliquer
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Filtres actifs -->
  <div class="active-filters-container" id="active-filters">
    <!-- Les filtres actifs seront ajout√©s ici dynamiquement -->
  </div>

  <!-- Grille d'ench√®res am√©lior√©e -->
  <div class="auction-grid" role="list" id="auction-grid">
    {% for enchere in enchaires %}
    <article
      class="auction-card {% if user in enchere.savers.all %}bookmarked{% endif %}"
      role="listitem"
      data-url="{% url 'details_enchaire' enchere.id %}"
      data-title="{{ enchere.lot.nom|lower }}"
      data-description="{{ enchere.lot.description|lower }}"
      data-category="{{ enchere.lot.type }}"
      data-wilaya="{{ enchere.lot.wilaya|default:'' }}"
      data-status="{% if enchere.date_fin|timeuntil|slice:':2' == '0 ' %}ending-soon{% elif enchere.etat == 'active' %}active{% elif enchere.etat == 'upcoming' %}upcoming{% else %}ended{% endif %}"
      onclick="window.location.href = this.getAttribute('data-url')"
      style="cursor: pointer;"
    >
      <div class="card-image">
        {% if enchere.main_image_url %}
        <img
          src="{{ enchere.main_image_url }}"
          alt="{{ enchere.lot.nom }}"
          loading="lazy"
          width="300"
          height="200"
        />
        {% else %}
        <img
          src="/media/images/default-image.jpg"
          alt="Image par d√©faut"
          loading="lazy"
          width="300"
          height="200"
        />
        {% endif %}

        <!-- Badge de cat√©gorie -->
        <div class="lot-type-badge {{ enchere.lot.type }}">
          <i class="fas fa-tag"></i>
          {{ enchere.lot.get_type_display }}
        </div>

        <!-- Bouton favoris √† la place du badge de statut -->
        <form method="post" action="{% url 'toggle_favori' enchere.id %}" class="bookmark-form-top">
          {% csrf_token %}
          <button
            type="submit"
            class="bookmark-btn-top"
            aria-label="{% if user in enchere.savers.all %}Retirer des favoris{% else %}Ajouter aux favoris{% endif %}"
            aria-pressed="{% if user in enchere.savers.all %}true{% else %}false{% endif %}"
            onclick="event.stopPropagation();"
          >
            <i class="fas fa-bookmark {% if user in enchere.savers.all %}saved{% endif %}"></i>
          </button>
        </form>

        <!-- Overlay avec timer -->
        <div class="card-overlay">
          <div class="time-remaining">
            <i class="fas fa-clock" aria-hidden="true"></i>
            <span class="countdown" data-end="{{ enchere.date_fin }}">
              {{ enchere.date_fin|timeuntil }} restantes
            </span>
          </div>
        </div>
      </div>

      <div class="card-content">
        <!-- Titre de l'ench√®re -->
        <h3 class="auction-title">{{ enchere.lot.nom }}</h3>
        
        <!-- Description avec hauteur fixe -->
        <div class="card-description-container">
          <p class="card-description">
            {% if enchere.lot.description|wordcount > 50 %}
              {{ enchere.lot.description|truncatewords:11 }}... 
              <a href="{% url 'details_enchaire' enchere.id %}">Voir plus</a>
            {% else %}
              {{ enchere.lot.description }}
            {% endif %}
          </p>
        </div>

        <!-- Informations de localisation - position fixe -->
        <div class="location-info">
          <div class="wilaya-info">
            <i class="fas fa-map-marker-alt"></i>
            <span class="wilaya-name">{{ enchere.wilaya|default:"Non sp√©cifi√©" }}</span>
          </div>
          <div class="time-remaining-inline">
            <span> | </span>
            <i class="fas fa-clock" aria-hidden="true"></i>
            <span class="countdown" data-end="{{ enchere.date_fin }}">
              {{ enchere.date_fin|timeuntil }} restantes
            </span>
          </div>
        </div>
        
        <!-- Statistiques avec √©tat d'ench√®re -->
        <div class="auction-stats">
          <div class="stat-item">
              <i class="fas fa-users"></i>
              <span>{{ enchere.participant_count|default:"0" }} participants</span>
          </div>

          <div class="stat-item status-item">
            <div class="status-indicator 
              {% if enchere.date_fin|timeuntil|slice:':2' == '0 ' %}ending-soon
              {% elif enchere.etat == 'active' %}active
              {% elif enchere.etat == 'upcoming' %}upcoming
              {% else %}ended{% endif %}">
              <i class="fas {% if enchere.date_fin|timeuntil|slice:':2' == '0 ' %}fa-fire-alt
                            {% elif enchere.etat == 'active' %}fa-play-circle
                            {% elif enchere.etat == 'upcoming' %}fa-clock
                            {% else %}fa-check-circle{% endif %}"></i>
              <span>
                {% if enchere.date_fin|timeuntil|slice:':2' == '0 ' %}Se termine bient√¥t
                {% elif enchere.etat == 'active' %}En cours
                {% elif enchere.etat == 'upcoming' %}√Ä venir
                {% else %}Termin√©e{% endif %}
              </span>
            </div>
          </div>
        </div>
      </div>
    </article>
    {% empty %}
    <div class="auction-results-empty">
      <div class="empty-icon">
        <i class="fas fa-search" aria-hidden="true"></i>
      </div>
      <h3 class="empty-title">Aucune ench√®re trouv√©e</h3>
      <p class="empty-message">Aucune ench√®re ne correspond √† vos crit√®res de recherche. Essayez de modifier vos filtres.</p>
      <button class="reset-filters-btn" onclick="clearAllFilters()">
        <i class="fas fa-undo"></i>
        R√©initialiser les filtres
      </button>
    </div>
    {% endfor %}
  </div>
</section>

<style>
/* ===== VARIABLES CSS ===== */
:root {
  --primary-color: #ff6b35;
  --primary-gradient: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
  --dark-bg: #1a1a1a;
  --sidebar-bg: #1e1e1e;
  --card-bg: #2d2d2d;
  --border-color: #404040;
  --text-light: #adb5bd;
  --text-muted: #6c757d;
  --white: #ffffff;
  --shadow-light: 0 3px 15px rgba(0, 0, 0, 0.1);
  --shadow-medium: 0 4px 20px rgba(0, 0, 0, 0.15);
  --shadow-heavy: 0 8px 30px rgba(0, 0, 0, 0.2);
  --input-bg: #2a2a2a;
  --input-border: #404040;
  --input-text: #e0e0e0;
  --button-bg: #333333;
  --button-hover-bg: #444444;
  
  /* Variables pour les badges de cat√©gorie */
  --vehicules-color: #3b82f6;
  --immobilier-color: #10b981;
  --materiel_pro-color: #f59e0b;
  --informatique-color: #8b5cf6;
  --mobilier-color: #06b6d4;
  --bijoux-color: #ec4899;
  
  /* Variables pour les badges de statut */
  --active-color: #10b981;
  --upcoming-color: #3b82f6;
  --ending-soon-color: #ef4444;
  --ended-color: #6b7280;
}

/* ===== LAYOUT PRINCIPAL ===== */
.auctions-section {
  background-color: var(--dark-bg);
  min-height: 100vh;
  padding: 16px;
  color: var(--white);
  border-radius: 16px;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
}

.search-filter-container {
  display: flex;
  flex-direction: column;
  gap: 16px;
  margin-bottom: 24px;
  width: 100%;
  max-width: 1000px;
  margin-left: auto;
  margin-right: auto;
  animation: fadeInUp 0.6s ease-out;
}

/* ===== BARRE DE RECHERCHE ===== */
.search-box-container {
  width: 100%;
}

.search-form {
  width: 100%;
}

.search-input-wrapper {
  position: relative;
  width: 100%;
}

.search-input {
  width: 100%;
  padding: 12px 55px 12px 18px;
  font-size: 16px;
  border: none;
  border-radius: 40px;
  background-color: var(--input-bg);
  color: var(--input-text);
  transition: all 0.3s ease;
  outline: none;
  font-family: inherit;
  box-shadow: var(--shadow-light);
  font-weight: 500;
  border: 1px solid var(--input-border);
}

.search-input:focus {
  background-color: #333;
  box-shadow: var(--shadow-medium);
  transform: translateY(-1px);
  border-color: var(--primary-color);
}

.search-input::placeholder {
  color: var(--text-muted);
  font-style: italic;
  font-weight: 400;
}

.search-btn {
  position: absolute;
  right: 4px;
  top: 50%;
  transform: translateY(-50%);
  background: var(--primary-gradient);
  border: none;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--white);
  font-size: 16px;
  box-shadow: 0 3px 12px rgba(255, 107, 53, 0.3);
}

.search-btn:hover {
  background: linear-gradient(135deg, #f7931e 0%, #ff6b35 100%);
  transform: translateY(-50%) scale(1.05);
  box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
}

/* ===== BOUTONS DE FILTRES ===== */
.filter-buttons-container {
  display: flex;
  align-items: center;
  gap: 12px;
  justify-content: center;
  width: 100%;
  flex-wrap: wrap;
}

.filter-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 10px 16px;
  border: none;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  text-transform: uppercase;
  letter-spacing: 0.3px;
  min-width: 100px;
  justify-content: center;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  position: relative;
}

.filter-btn-dark {
  background-color: var(--button-bg);
  color: var(--white);
  border: 1px solid var(--border-color);
}

.filter-btn-dark:hover {
  background-color: var(--button-hover-bg);
  border-color: var(--primary-color);
  transform: translateY(-1px);
  box-shadow: 0 3px 12px rgba(0, 0, 0, 0.2);
}

.filter-count {
  position: absolute;
  top: -6px;
  right: -6px;
  background-color: #ff4444;
  color: var(--white);
  border-radius: 50%;
  width: 16px;
  height: 16px;
  font-size: 9px;
  display: none;
  align-items: center;
  justify-content: center;
  font-weight: bold;
}

/* ===== DROPDOWNS ===== */
.filter-dropdown {
  position: relative;
}

.dropdown-arrow {
  font-size: 10px;
  transition: transform 0.3s ease;
  margin-left: auto;
}

.filter-dropdown.open .dropdown-arrow {
  transform: rotate(180deg);
}

.dropdown-menu {
  position: absolute;
  top: calc(100% + 8px);
  left: 50%;
  transform: translateX(-50%);
  background: var(--card-bg);
  border: 1px solid var(--border-color);
  border-radius: 12px;
  box-shadow: var(--shadow-heavy);
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transform: translateX(-50%) translateY(-8px);
  transition: all 0.3s ease;
  min-width: 180px;
  overflow: hidden;
}

.dropdown-menu.show {
  opacity: 1;
  visibility: visible;
  transform: translateX(-50%) translateY(0);
}

.dropdown-item {
  display: block;
  padding: 12px 18px;
  color: var(--white);
  text-decoration: none;
  transition: all 0.2s ease;
  border-bottom: 1px solid var(--border-color);
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
}

.dropdown-item:last-child {
  border-bottom: none;
}

.dropdown-item:hover {
  background-color: rgba(255, 107, 53, 0.1);
  color: var(--primary-color);
  padding-left: 22px;
}

/* ===== SIDEBAR OPTIMIS√âE ===== */
.sidebar-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.7);
  z-index: 9998;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s ease, visibility 0.3s ease;
  backdrop-filter: blur(3px);
}

.sidebar-overlay.active {
  opacity: 1;
  visibility: visible;
}

.sidebar {
  position: fixed;
  top: 0;
  left: -280px;
  width: 280px;
  height: 100vh;
  background: linear-gradient(180deg, var(--sidebar-bg) 0%, #1a1a1a 100%);
  z-index: 9999;
  transition: left 0.3s ease;
  overflow-y: auto;
  box-shadow: 3px 0 20px rgba(0, 0, 0, 0.8);
  border-right: 1px solid var(--border-color);
}

.sidebar.open {
  left: 0;
}

.sidebar-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px;
  border-bottom: 1px solid var(--border-color);
  background-color: rgba(255, 107, 53, 0.1);
  margin-top: 50px;
}

.sidebar-title {
  color: var(--white);
  font-size: 16px;
  font-weight: 600;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 8px;
}

.sidebar-title i {
  color: var(--primary-color);
}

.close-btn {
  background: none;
  border: none;
  color: var(--text-light);
  font-size: 18px;
  cursor: pointer;
  padding: 6px;
  border-radius: 50%;
  transition: all 0.3s ease;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.close-btn:hover {
  background-color: rgba(255, 107, 53, 0.1);
  color: var(--primary-color);
  transform: rotate(90deg);
}

.sidebar-content {
  padding: 16px;
}

/* ===== GROUPES DE FILTRES COMPACTS ===== */
.filter-group {
  margin-bottom: 20px;
  opacity: 0;
  transform: translateX(-20px);
  animation: slideIn 0.3s ease forwards;
  border-bottom: 1px solid var(--border-color);
  padding-bottom: 16px;
  position: relative;
  z-index: 1;
}

.filter-group:last-child {
  border-bottom: none;
}

.filter-group:nth-child(1) { animation-delay: 0.1s; }
.filter-group:nth-child(2) { animation-delay: 0.2s; }
.filter-group:nth-child(3) { animation-delay: 0.3s; }

.filter-group-title {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 600;
  font-size: 13px;
  color: var(--white);
  margin-bottom: 12px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.filter-group-title i {
  color: var(--primary-color);
}

/* ===== SELECT COMPACTS ===== */
.select-wrapper-compact {
  position: relative;
  width: 100%;
}

.styled-select-compact {
  width: 100%;
  padding: 8px 12px;
  font-size: 13px;
  background-color: var(--input-bg);
  color: var(--white);
  border: 1px solid var(--border-color);
  border-radius: 6px;
  appearance: none;
  cursor: pointer;
  transition: all 0.3s ease;
  background-image: url("data:image/svg+xml;utf8,<svg fill='%23adb5bd' height='24' viewBox='0 0 24 24' width='24' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
  background-repeat: no-repeat;
  background-position: right 8px center;
  background-size: 12px;
}

.styled-select-compact:focus {
  outline: none;
  border-color: var(--primary-color);
  background-color: #333;
  box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.1);
}

.styled-select-compact:hover {
  border-color: #555;
  background-color: #333;
}

/* ===== BOUTONS D'ACTION COMPACTS ===== */
.filter-actions-compact {
  margin-top: 20px;
  display: flex;
  gap: 8px;
}

.filter-action-btn-compact {
  flex: 1;
  padding: 10px 12px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 11px;
  font-weight: 600;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

.filter-action-btn-compact.primary {
  background: var(--primary-gradient);
  color: var(--white);
  box-shadow: 0 3px 12px rgba(255, 107, 53, 0.3);
}

.filter-action-btn-compact.primary:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
}

.filter-action-btn-compact.secondary {
  background-color: #444;
  color: var(--text-light);
  border: 1px solid var(--border-color);
}

.filter-action-btn-compact.secondary:hover {
  background-color: #555;
  color: var(--white);
  transform: translateY(-1px);
}

/* ===== FILTRES ACTIFS ===== */
.active-filters-container {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin: 0 auto 20px;
  max-width: 1000px;
  padding: 0 10px;
}

.active-filter {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 4px 10px;
  background-color: rgba(255, 107, 53, 0.1);
  border: 1px solid rgba(255, 107, 53, 0.3);
  border-radius: 16px;
  font-size: 11px;
  color: var(--white);
  animation: fadeIn 0.3s ease;
}

.active-filter-label {
  font-weight: 600;
  color: var(--primary-color);
}

.active-filter-value {
  color: var(--text-light);
}

.remove-filter {
  background: none;
  border: none;
  color: var(--text-muted);
  cursor: pointer;
  width: 14px;
  height: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.2s ease;
  padding: 0;
  font-size: 9px;
}

.remove-filter:hover {
  background-color: rgba(255, 255, 255, 0.1);
  color: var(--white);
}

/* ===== CARTES D'ENCH√àRES ===== */
.auction-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 20px;
  margin: 0 auto;
  max-width: 1000px;
}

.auction-card {
  background-color: var(--card-bg);
  border-radius: 12px;
  overflow: hidden;
  transition: all 0.3s ease;
  border: 1px solid var(--border-color);
  position: relative;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  height: 100%;
}

.auction-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
  border-color: var(--primary-color);
}

.auction-card.hidden {
  display: none;
}

.card-image {
  position: relative;
  height: 200px;
  overflow: hidden;
}

.card-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.5s ease;
}

.auction-card:hover .card-image img {
  transform: scale(1.05);
}

/* ===== BADGES DE CAT√âGORIE ===== */
.lot-type-badge {
  position: absolute;
  top: 12px;
  left: 12px;
  padding: 6px 10px;
  border-radius: 20px;
  font-size: 11px;
  font-weight: 600;
  color: var(--white);
  display: flex;
  align-items: center;
  gap: 5px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  z-index: 2;
}

.lot-type-badge.vehicules {
  background: linear-gradient(135deg, var(--vehicules-color) 0%, #1d4ed8 100%);
}

.lot-type-badge.immobilier {
  background: linear-gradient(135deg, var(--immobilier-color) 0%, #047857 100%);
}

.lot-type-badge.materiel_pro {
  background: linear-gradient(135deg, var(--materiel_pro-color) 0%, #d97706 100%);
}

.lot-type-badge.informatique {
  background: linear-gradient(135deg, var(--informatique-color) 0%, #7c3aed 100%);
}

.lot-type-badge.mobilier {
  background: linear-gradient(135deg, var(--mobilier-color) 0%, #0891b2 100%);
}

.lot-type-badge.bijoux {
  background: linear-gradient(135deg, var(--bijoux-color) 0%, #db2777 100%);
}

/* ===== BOUTON FAVORIS EN HAUT ===== */
.bookmark-form-top {
  position: absolute;
  top: 12px;
  right: 12px;
  z-index: 2;
}

.bookmark-btn-top {
  background: rgba(0, 0, 0, 0.6);
  border: none;
  border-radius: 50%;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  color: var(--white);
  font-size: 14px;
  backdrop-filter: blur(5px);
}

.bookmark-btn-top:hover {
  background: rgba(0, 0, 0, 0.8);
  transform: scale(1.1);
}

.bookmark-btn-top i {
  transition: all 0.3s ease;
}

.bookmark-btn-top i.saved {
  color: var(--primary-color);
}

/* ===== OVERLAY ET TIMER ===== */
.card-overlay {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: linear-gradient(to top, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0) 100%);
  padding: 30px 15px 15px;
  z-index: 1;
}

.time-remaining {
  display: flex;
  align-items: center;
  gap: 8px;
  color: var(--white);
  font-size: 14px;
  font-weight: 600;
}

.time-remaining i {
  color: var(--primary-color);
}

.countdown {
  font-family: 'Inter', monospace;
  letter-spacing: 0.5px;
}

/* ===== CONTENU DE LA CARTE ===== */
.card-content {
  padding: 16px;
  display: flex;
  flex-direction: column;
  flex-grow: 1;
}

.auction-title {
  font-size: 16px;
  font-weight: 700;
  margin: 0 0 10px;
  color: var(--white);
  line-height: 1.3;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* ===== CONTENEUR DE DESCRIPTION AVEC HAUTEUR FIXE ===== */
.card-description-container {
  margin-bottom: 16px;
}

.card-description {
  color: var(--text-light);
  line-height: 1.6;
  margin: 0;
  font-size: 14px;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.card-description a {
  color: var(--primary-color);
  text-decoration: none;
  font-weight: 600;
  transition: all 0.2s ease;
}

.card-description a:hover {
  filter: brightness(1.2);
}

/* ===== INFORMATIONS DE LOCALISATION - POSITION FIXE ===== */
.location-info {
  display: flex;
  align-items: center;
  margin-bottom: 16px;
  padding: 10px;
  background-color: rgba(0, 0, 0, 0.2);
  border-radius: 8px;
  white-space: nowrap;
  overflow: hidden;
  margin-top: auto;
}

.wilaya-info {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-shrink: 0;
}

.wilaya-info i {
  color: var(--primary-color);
  font-size: 14px;
}

.wilaya-name {
  font-size: 13px;
  font-weight: 600;
  color: var(--white);
}

.time-remaining-inline {
  display: flex;
  align-items: center;
  gap: 8px;
  color: var(--white);
  font-size: 13px;
  font-weight: 600;
  margin-left: 8px;
  flex-shrink: 0;
}

.time-remaining-inline i {
  color: var(--primary-color);
}

/* ===== STATISTIQUES AVEC √âTAT ===== */
.auction-stats {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: 12px;
  border-top: 1px solid var(--border-color);
}

.stat-item {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  color: var(--text-light);
}

.stat-item i {
  color: var(--text-muted);
}

.status-item {
  margin-left: auto;
}

.status-indicator {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

.status-indicator.active {
  background-color: rgba(16, 185, 129, 0.2);
  color: var(--active-color);
}

.status-indicator.upcoming {
  background-color: rgba(59, 130, 246, 0.2);
  color: var(--upcoming-color);
}

.status-indicator.ending-soon {
  background-color: rgba(239, 68, 68, 0.2);
  color: var(--ending-soon-color);
  animation: pulse-status 1.5s infinite;
}

.status-indicator.ended {
  background-color: rgba(107, 114, 128, 0.2);
  color: var(--ended-color);
}

@keyframes pulse-status {
  0% {
    box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4);
  }
  70% {
    box-shadow: 0 0 0 4px rgba(239, 68, 68, 0);
  }
  100% {
    box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
  }
}

/* ===== √âTAT VIDE ===== */
.auction-results-empty {
  grid-column: 1 / -1;
  text-align: center;
  padding: 60px 20px;
  background-color: var(--card-bg);
  border-radius: 12px;
  border: 1px solid var(--border-color);
  margin: 30px auto;
  max-width: 600px;
}

.empty-icon {
  font-size: 48px;
  color: var(--text-muted);
  margin-bottom: 16px;
}

.empty-title {
  font-size: 24px;
  font-weight: 700;
  color: var(--white);
  margin-bottom: 12px;
}

.empty-message {
  font-size: 16px;
  color: var(--text-light);
  margin-bottom: 24px;
  line-height: 1.6;
}

.reset-filters-btn {
  padding: 12px 24px;
  background: var(--primary-gradient);
  color: var(--white);
  border: none;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.reset-filters-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
}

/* ===== ANIMATIONS ===== */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideIn {
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* ===== SCROLLBAR PERSONNALIS√âE ===== */
.sidebar::-webkit-scrollbar {
  width: 4px;
}

.sidebar::-webkit-scrollbar-track {
  background: #2a2a2a;
}

.sidebar::-webkit-scrollbar-thumb {
  background: var(--border-color);
  border-radius: 2px;
}

.sidebar::-webkit-scrollbar-thumb:hover {
  background: #666;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 768px) {
  .search-filter-container {
    gap: 12px;
    padding: 0 12px;
    margin-bottom: 20px;
  }
  
  .filter-buttons-container {
    gap: 10px;
  }
  
  .search-input {
    font-size: 16px;
    padding: 10px 50px 10px 16px;
  }
  
  .search-btn {
    width: 36px;
    height: 36px;
    font-size: 14px;
  }
  
  .filter-btn {
    padding: 8px 14px;
    font-size: 11px;
    min-width: 85px;
  }

  .sidebar {
    width: 100%;
    left: -100%;
  }
  
  .sidebar-header {
    margin-top: 40px;
  }

  .categories-compact {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 480px) {
  .auctions-section {
    padding: 12px;
  }

  .search-input {
    padding: 8px 45px 8px 14px;
    font-size: 15px;
  }
  
  .search-btn {
    width: 32px;
    height: 32px;
    font-size: 13px;
  }
  
  .filter-btn {
    padding: 6px 12px;
    font-size: 10px;
    min-width: 75px;
  }
}

/* ===== DROPDOWN WILAYAS - Z-INDEX ULTRA √âLEV√â ===== */
.wilaya-dropdown-wrapper,
.category-dropdown-wrapper {
  position: relative;
  width: 100%;
  z-index: 100;
}

.wilaya-dropdown-btn {
  width: 100%;
  padding: 10px 12px;
  background-color: var(--input-bg);
  color: var(--white);
  border: 1px solid var(--border-color);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-size: 13px;
  font-weight: 500;
}

.wilaya-dropdown-btn:hover {
  border-color: var(--primary-color);
  background-color: #333;
}

.wilaya-dropdown-btn.active {
  border-color: var(--primary-color);
  background-color: rgba(255, 107, 53, 0.1);
}

.wilaya-dropdown-arrow {
  font-size: 10px;
  transition: transform 0.3s ease;
}

.wilaya-dropdown-btn.open .wilaya-dropdown-arrow {
  transform: rotate(180deg);
}

.wilaya-dropdown-menu {
  position: absolute;
  top: calc(100% + 4px);
  left: 0;
  right: 0;
  background: var(--card-bg);
  border: 1px solid var(--border-color);
  border-radius: 8px;
  box-shadow: var(--shadow-heavy);
  z-index: 99999;
  opacity: 0;
  visibility: hidden;
  transform: translateY(-8px);
  transition: all 0.3s ease;
  max-height: 300px;
  overflow-y: auto;
}

.wilaya-dropdown-menu.show {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
}

.wilaya-dropdown-content {
  padding: 8px;
}

.wilaya-dropdown-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px;
  border-bottom: 1px solid var(--border-color);
  margin-bottom: 8px;
}

.wilaya-dropdown-header span {
  font-size: 11px;
  color: var(--text-light);
  font-weight: 500;
}

.wilaya-clear-btn {
  background: none;
  border: none;
  color: var(--primary-color);
  font-size: 11px;
  cursor: pointer;
  padding: 2px 6px;
  border-radius: 4px;
  transition: all 0.2s ease;
}

.wilaya-clear-btn:hover {
  background-color: rgba(255, 107, 53, 0.1);
  text-decoration: underline;
}

.wilaya-dropdown-search {
  margin-bottom: 8px;
  padding: 0 8px;
}

.wilaya-dropdown-search input {
  width: 100%;
  padding: 8px 10px;
  background-color: var(--input-bg);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--white);
  font-size: 12px;
}

.wilaya-dropdown-search input:focus {
  outline: none;
  border-color: var(--primary-color);
}

.wilaya-dropdown-items {
  max-height: 200px;
  overflow-y: auto;
}

.wilaya-dropdown-item {
  display: flex;
  align-items: center;
  padding: 8px 12px;
  cursor: pointer;
  border-radius: 4px;
  transition: all 0.2s ease;
  position: relative;
  margin-bottom: 2px;
}

.wilaya-dropdown-item:last-child {
  margin-bottom: 0;
}

.wilaya-dropdown-item:hover {
  background-color: rgba(255, 107, 53, 0.1);
}

.wilaya-dropdown-item input {
  position: absolute;
  opacity: 0;
  cursor: pointer;
  height: 0;
  width: 0;
}

.wilaya-checkmark {
  width: 16px;
  height: 16px;
  background-color: var(--input-bg);
  border: 1px solid var(--border-color);
  border-radius: 3px;
  margin-right: 10px;
  position: relative;
  transition: all 0.2s ease;
  flex-shrink: 0;
}

.wilaya-dropdown-item:hover .wilaya-checkmark {
  border-color: var(--primary-color);
}

.wilaya-dropdown-item input:checked ~ .wilaya-checkmark {
  background-color: var(--primary-color);
  border-color: var(--primary-color);
}

.wilaya-checkmark:after {
  content: "";
  position: absolute;
  display: none;
  left: 5px;
  top: 2px;
  width: 4px;
  height: 8px;
  border: solid white;
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

.wilaya-dropdown-item input:checked ~ .wilaya-checkmark:after {
  display: block;
}

.wilaya-text {
  color: var(--text-light);
  font-size: 12px;
  font-weight: 500;
  transition: color 0.2s ease;
}

.wilaya-dropdown-item:hover .wilaya-text,
.wilaya-dropdown-item input:checked ~ .wilaya-text {
  color: var(--white);
}

.wilaya-dropdown-item.disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Scrollbar pour le dropdown des wilayas */
.wilaya-dropdown-items::-webkit-scrollbar {
  width: 4px;
}

.wilaya-dropdown-items::-webkit-scrollbar-track {
  background: #2a2a2a;
}

.wilaya-dropdown-items::-webkit-scrollbar-thumb {
  background: var(--border-color);
  border-radius: 2px;
}

/* ===== DROPDOWN CAT√âGORIES - Z-INDEX ULTRA √âLEV√â ===== */
.category-dropdown-btn {
  width: 100%;
  padding: 10px 12px;
  background-color: var(--input-bg);
  color: var(--white);
  border: 1px solid var(--border-color);
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-size: 13px;
  font-weight: 500;
}

.category-dropdown-btn:hover {
  border-color: var(--primary-color);
  background-color: #333;
}

.category-dropdown-btn.active {
  border-color: var(--primary-color);
  background-color: rgba(255, 107, 53, 0.1);
}

.category-dropdown-arrow {
  font-size: 10px;
  transition: transform 0.3s ease;
}

.category-dropdown-btn.open .category-dropdown-arrow {
  transform: rotate(180deg);
}

.category-dropdown-menu {
  position: absolute;
  top: calc(100% + 4px);
  left: 0;
  right: 0;
  background: var(--card-bg);
  border: 1px solid var(--border-color);
  border-radius: 8px;
  box-shadow: var(--shadow-heavy);
  z-index: 99999;
  opacity: 0;
  visibility: hidden;
  transform: translateY(-8px);
  transition: all 0.3s ease;
  max-height: 300px;
  overflow-y: auto;
}

.category-dropdown-menu.show {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
}

.category-dropdown-content {
  padding: 8px;
  z-index: 99999
}

.category-dropdown-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px;
  border-bottom: 1px solid var(--border-color);
  margin-bottom: 8px;
}

.category-dropdown-header span {
  font-size: 11px;
  color: var(--text-light);
  font-weight: 500;
}

.category-clear-btn {
  background: none;
  border: none;
  color: var(--primary-color);
  font-size: 11px;
  cursor: pointer;
  padding: 2px 6px;
  border-radius: 4px;
  transition: all 0.2s ease;
}

.category-clear-btn:hover {
  background-color: rgba(255, 107, 53, 0.1);
  text-decoration: underline;
}

.category-dropdown-search {
  margin-bottom: 8px;
  padding: 0 8px;
}

.category-dropdown-search input {
  width: 100%;
  padding: 8px 10px;
  background-color: var(--input-bg);
  border: 1px solid var(--border-color);
  border-radius: 4px;
  color: var(--white);
  font-size: 12px;
}

.category-dropdown-search input:focus {
  outline: none;
  border-color: var(--primary-color);
}

.category-dropdown-items {
  max-height: 200px;
  overflow-y: auto;
}

.category-dropdown-item {
  display: flex;
  align-items: center;
  padding: 8px 12px;
  cursor: pointer;
  border-radius: 4px;
  transition: all 0.2s ease;
  position: relative;
  margin-bottom: 2px;
}

.category-dropdown-item:last-child {
  margin-bottom: 0;
}

.category-dropdown-item:hover {
  background-color: rgba(255, 107, 53, 0.1);
}

.category-dropdown-item input {
  position: absolute;
  opacity: 0;
  cursor: pointer;
  height: 0;
  width: 0;
}

.category-checkmark {
  width: 16px;
  height: 16px;
  background-color: var(--input-bg);
  border: 1px solid var(--border-color);
  border-radius: 3px;
  margin-right: 10px;
  position: relative;
  transition: all 0.2s ease;
  flex-shrink: 0;
}

.category-dropdown-item:hover .category-checkmark {
  border-color: var(--primary-color);
}

.category-dropdown-item input:checked ~ .category-checkmark {
  background-color: var(--primary-color);
  border-color: var(--primary-color);
}

.category-checkmark:after {
  content: "";
  position: absolute;
  display: none;
  left: 5px;
  top: 2px;
  width: 4px;
  height: 8px;
  border: solid white;
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

.category-dropdown-item input:checked ~ .category-checkmark:after {
  display: block;
}

.category-text {
  color: var(--text-light);
  font-size: 12px;
  font-weight: 500;
  transition: color 0.2s ease;
}

.category-dropdown-item:hover .category-text,
.category-dropdown-item input:checked ~ .category-text {
  color: var(--white);
}

/* Scrollbar pour le dropdown des cat√©gories */
.category-dropdown-items::-webkit-scrollbar {
  width: 4px;
}

.category-dropdown-items::-webkit-scrollbar-track {
  background: #2a2a2a;
}

.category-dropdown-items::-webkit-scrollbar-thumb {
  background: var(--border-color);
  border-radius: 2px;
}
</style>

<script>
// ===== VARIABLES GLOBALES =====
let activeFilters = new Set();
let isAnimating = false;
let searchTimeout;
let allCards = [];

// ===== INITIALISATION =====
document.addEventListener('DOMContentLoaded', function() {
  allCards = Array.from(document.querySelectorAll('.auction-card'));
  initializeEventListeners();
  updateFilters();
});

// ===== RECHERCHE LIVE =====
function performLiveSearch(searchTerm) {
  clearTimeout(searchTimeout);
  searchTimeout = setTimeout(() => {
    const term = searchTerm.toLowerCase().trim();
    
    allCards.forEach(card => {
      if (term === '') {
        card.classList.remove('hidden');
        return;
      }
      
      const title = card.getAttribute('data-title') || '';
      const description = card.getAttribute('data-description') || '';
      
      if (title.includes(term) || description.includes(term)) {
        card.classList.remove('hidden');
      } else {
        card.classList.add('hidden');
      }
    });
    
    updateResultsCount();
  }, 300);
}

// ===== FILTRAGE PAR STATUT =====
function filterByStatus(status) {
  allCards.forEach(card => {
    const cardStatus = card.getAttribute('data-status');
    
    if (status === 'all' || cardStatus === status) {
      card.classList.remove('hidden');
    } else {
      card.classList.add('hidden');
    }
  });
  
  updateResultsCount();
  
  // Fermer le dropdown
  const dropdown = document.getElementById('status-dropdown');
  const container = dropdown.parentElement;
  dropdown.classList.remove('show');
  container.classList.remove('open');
}

// ===== GESTION DES DROPDOWNS =====
function toggleDropdown(dropdownId) {
  const allDropdowns = document.querySelectorAll('.dropdown-menu');
  const allDropdownContainers = document.querySelectorAll('.filter-dropdown');
  
  allDropdowns.forEach((menu, index) => {
    if (menu.id !== dropdownId) {
      menu.classList.remove('show');
      allDropdownContainers[index].classList.remove('open');
    }
  });
  
  const dropdown = document.getElementById(dropdownId);
  const container = dropdown.parentElement;
  
  dropdown.classList.toggle('show');
  container.classList.toggle('open');
}

// ===== GESTION DE LA SIDEBAR =====
function toggleSidebar() {
  if (isAnimating) return;
  isAnimating = true;

  const sidebar = document.getElementById("sidebar");
  const overlay = document.getElementById("sidebar-overlay");
  const isOpen = sidebar.classList.contains("open");

  if (isOpen) {
    closeSidebar();
  } else {
    openSidebar();
  }

  setTimeout(() => {
    isAnimating = false;
  }, 300);
}

function openSidebar() {
  const sidebar = document.getElementById("sidebar");
  const overlay = document.getElementById("sidebar-overlay");
  
  sidebar.classList.add("open");
  overlay.classList.add("active");
  document.body.style.overflow = "hidden";
}

function closeSidebar() {
  const sidebar = document.getElementById("sidebar");
  const overlay = document.getElementById("sidebar-overlay");
  
  sidebar.classList.remove("open");
  overlay.classList.remove("active");
  document.body.style.overflow = "";
}

// ===== GESTION DES FILTRES =====
function updateFilters() {
  const dateFilter = document.getElementById("date-filter").value;
  const selectedCategories = document.querySelectorAll('input[name="category"]:checked');
  const selectedWilayas = document.querySelectorAll('input[name="wilaya"]:checked');

  activeFilters.clear();
  
  if (selectedWilayas.length > 0) activeFilters.add("wilaya");
  if (dateFilter !== "all") activeFilters.add("date");
  if (selectedCategories.length > 0) activeFilters.add("categories");

  updateFilterDisplay();
  updateFilterCount();
  updateActiveFiltersDisplay();
}

function updateFilterDisplay() {
  const filterGroups = document.querySelectorAll('.filter-group');
  
  filterGroups.forEach(group => {
    const filterName = group.getAttribute('data-filter');
    if (activeFilters.has(filterName)) {
      group.classList.add('active');
    } else {
      group.classList.remove('active');
    }
  });
}

function updateFilterCount() {
  const countElement = document.getElementById("filter-count");
  const count = activeFilters.size;
  
  if (count > 0) {
    countElement.textContent = count;
    countElement.style.display = "flex";
  } else {
    countElement.style.display = "none";
  }
}

function updateActiveFiltersDisplay() {
  const container = document.getElementById("active-filters");
  container.innerHTML = "";

  if (activeFilters.has("wilaya")) {
    const selectedWilayas = document.querySelectorAll('input[name="wilaya"]:checked');
    selectedWilayas.forEach(wilaya => {
      const wilayaText = wilaya.nextElementSibling.nextElementSibling.textContent;
      addActiveFilter("Wilaya", wilayaText, "wilaya", wilaya.value);
    });
  }

  if (activeFilters.has("date")) {
    const dateSelect = document.getElementById("date-filter");
    const dateText = dateSelect.options[dateSelect.selectedIndex].text;
    addActiveFilter("Date", dateText, "date");
  }

  if (activeFilters.has("categories")) {
    const selectedCategories = document.querySelectorAll('input[name="category"]:checked');
    selectedCategories.forEach(category => {
      const categoryText = category.nextElementSibling.nextElementSibling.textContent;
      addActiveFilter("Cat√©gorie", categoryText, "category", category.value);
    });
  }
}

function addActiveFilter(label, value, type, specificValue = null) {
  const container = document.getElementById("active-filters");
  const filterElement = document.createElement("div");
  filterElement.className = "active-filter";
  filterElement.innerHTML = `
    <span class="active-filter-label">${label}:</span>
    <span class="active-filter-value">${value}</span>
    <button class="remove-filter" onclick="removeActiveFilter('${type}', '${specificValue}')">
      <i class="fas fa-times"></i>
    </button>
  `;
  container.appendChild(filterElement);
}

function removeActiveFilter(type, specificValue) {
  if (type === "wilaya" && specificValue) {
    const checkbox = document.querySelector(`input[name="wilaya"][value="${specificValue}"]`);
    if (checkbox) {
      checkbox.checked = false;
      updateWilayaSelection(checkbox);
    }
  } else if (type === "date") {
    document.getElementById("date-filter").value = "all";
  } else if (type === "category" && specificValue) {
    const checkbox = document.querySelector(`input[name="category"][value="${specificValue}"]`);
    if (checkbox) {
      checkbox.checked = false;
      updateCategorySelection(checkbox);
    }
  }
  
  updateFilters();
}

function clearAllFilters() {
  document.getElementById("date-filter").value = "all";
  
  // R√©initialiser les cat√©gories
  document.querySelectorAll('input[name="category"]').forEach(checkbox => {
    checkbox.checked = false;
  });
  const categorySelectedText = document.getElementById('category-selected-text');
  const categoryBtn = document.querySelector('.category-dropdown-btn');
  categorySelectedText.textContent = 'Toutes les cat√©gories';
  categoryBtn.classList.remove('active');
  
  // R√©initialiser les wilayas
  document.querySelectorAll('input[name="wilaya"]').forEach(checkbox => {
    checkbox.checked = false;
  });
  const wilayaSelectedText = document.getElementById('wilaya-selected-text');
  const wilayaBtn = document.querySelector('.wilaya-dropdown-btn');
  wilayaSelectedText.textContent = 'Toutes les wilayas';
  wilayaBtn.classList.remove('active');

  // R√©initialiser la recherche
  document.getElementById("live-search").value = "";
  
  // Afficher toutes les cartes
  allCards.forEach(card => {
    card.classList.remove('hidden');
  });

  activeFilters.clear();
  updateFilterDisplay();
  updateFilterCount();
  updateActiveFiltersDisplay();
  updateResultsCount();

  const btn = event.target;
  const originalText = btn.innerHTML;
  btn.innerHTML = '<i class="fas fa-check"></i> Effac√©';
  btn.style.background = '#28a745';

  setTimeout(() => {
    btn.innerHTML = originalText;
    btn.style.background = '';
  }, 1500);
}

function applyFilters() {
  const filters = {
    wilayas: Array.from(document.querySelectorAll('input[name="wilaya"]:checked')).map(cb => cb.value),
    date: document.getElementById("date-filter").value,
    categories: Array.from(document.querySelectorAll('input[name="category"]:checked')).map(cb => cb.value)
  };

  // Appliquer les filtres aux cartes
  allCards.forEach(card => {
    let shouldShow = true;
    
    // Filtre par wilaya
    if (filters.wilayas.length > 0) {
      const cardWilaya = card.getAttribute('data-wilaya');
      if (!filters.wilayas.includes(cardWilaya)) {
        shouldShow = false;
      }
    }
    
    // Filtre par cat√©gorie
    if (filters.categories.length > 0) {
      const cardCategory = card.getAttribute('data-category');
      if (!filters.categories.includes(cardCategory)) {
        shouldShow = false;
      }
    }
    
    if (shouldShow) {
      card.classList.remove('hidden');
    } else {
      card.classList.add('hidden');
    }
  });

  updateResultsCount();

  const btn = event.target;
  const originalText = btn.innerHTML;
  btn.innerHTML = '<i class="fas fa-check"></i> Appliqu√©';

  setTimeout(() => {
    btn.innerHTML = originalText;
    closeSidebar();
  }, 1000);
}

function updateResultsCount() {
  const visibleCards = allCards.filter(card => !card.classList.contains('hidden'));
  const emptyState = document.querySelector('.auction-results-empty');
  
  if (visibleCards.length === 0 && emptyState) {
    emptyState.style.display = 'block';
  } else if (emptyState) {
    emptyState.style.display = 'none';
  }
}

// ===== GESTION DU DROPDOWN WILAYAS =====
function toggleWilayaDropdown() {
  const dropdown = document.getElementById('wilaya-dropdown-menu');
  const btn = document.querySelector('.wilaya-dropdown-btn');

  dropdown.classList.toggle('show');
  btn.classList.toggle('open');
}

function updateWilayaSelection(checkbox) {
  const selectedWilayas = document.querySelectorAll('input[name="wilaya"]:checked');
  const selectedText = document.getElementById('wilaya-selected-text');
  const btn = document.querySelector('.wilaya-dropdown-btn');
  
  if (selectedWilayas.length === 0) {
    selectedText.textContent = 'Toutes les wilayas';
    btn.classList.remove('active');
  } else if (selectedWilayas.length === 1) {
    const wilayaText = selectedWilayas[0].nextElementSibling.nextElementSibling.textContent;
    selectedText.textContent = wilayaText;
    btn.classList.add('active');
  } else {
    selectedText.textContent = `${selectedWilayas.length} wilayas s√©lectionn√©es`;
    btn.classList.add('active');
  }

  updateFilters();
}

function clearWilayaSelection(event) {
  event.stopPropagation();
  
  document.querySelectorAll('input[name="wilaya"]').forEach(checkbox => {
    checkbox.checked = false;
  });
  
  const selectedText = document.getElementById('wilaya-selected-text');
  const btn = document.querySelector('.wilaya-dropdown-btn');
  
  selectedText.textContent = 'Toutes les wilayas';
  btn.classList.remove('active');
  
  updateFilters();
}

function filterWilayas(searchTerm) {
  const term = searchTerm.toLowerCase().trim();
  const items = document.querySelectorAll('.wilaya-dropdown-item');
  
  items.forEach(item => {
    const text = item.querySelector('.wilaya-text').textContent.toLowerCase();
    if (text.includes(term) || term === '') {
      item.style.display = 'flex';
    } else {
      item.style.display = 'none';
    }
  });
}

// ===== GESTION DU DROPDOWN CAT√âGORIES =====
function toggleCategoryDropdown() {
  const dropdown = document.getElementById('category-dropdown-menu');
  const btn = document.querySelector('.category-dropdown-btn');

  dropdown.classList.toggle('show');
  btn.classList.toggle('open');
}

function updateCategorySelection(checkbox) {
  const selectedCategories = document.querySelectorAll('input[name="category"]:checked');
  const selectedText = document.getElementById('category-selected-text');
  const btn = document.querySelector('.category-dropdown-btn');
  
  if (selectedCategories.length === 0) {
    selectedText.textContent = 'Toutes les cat√©gories';
    btn.classList.remove('active');
  } else if (selectedCategories.length === 1) {
    const categoryText = selectedCategories[0].nextElementSibling.nextElementSibling.textContent;
    selectedText.textContent = categoryText;
    btn.classList.add('active');
  } else {
    selectedText.textContent = `${selectedCategories.length} cat√©gories s√©lectionn√©es`;
    btn.classList.add('active');
  }

  updateFilters();
}

function clearCategorySelection(event) {
  event.stopPropagation();
  
  document.querySelectorAll('input[name="category"]').forEach(checkbox => {
    checkbox.checked = false;
  });
  
  const selectedText = document.getElementById('category-selected-text');
  const btn = document.querySelector('.category-dropdown-btn');
  
  selectedText.textContent = 'Toutes les cat√©gories';
  btn.classList.remove('active');
  
  updateFilters();
}

function filterCategories(searchTerm) {
  const term = searchTerm.toLowerCase().trim();
  const items = document.querySelectorAll('.category-dropdown-item');
  
  items.forEach(item => {
    const text = item.querySelector('.category-text').textContent.toLowerCase();
    if (text.includes(term) || term === '') {
      item.style.display = 'flex';
    } else {
      item.style.display = 'none';
    }
  });
}

// ===== EVENT LISTENERS =====
function initializeEventListeners() {
  // Fermer les dropdowns en cliquant √† l'ext√©rieur
  document.addEventListener('click', function(event) {
    if (!event.target.closest('.filter-dropdown')) {
      const allDropdowns = document.querySelectorAll('.dropdown-menu');
      const allDropdownContainers = document.querySelectorAll('.filter-dropdown');
      
      allDropdowns.forEach((menu, index) => {
        menu.classList.remove('show');
        allDropdownContainers[index].classList.remove('open');
      });
    }
  });

  // Fermer la sidebar avec l'overlay
  const overlay = document.getElementById("sidebar-overlay");
  if (overlay) {
    overlay.addEventListener("click", closeSidebar);
  }

  // Fermer avec Escape
  document.addEventListener("keydown", function(event) {
    if (event.key === "Escape") {
      const sidebar = document.getElementById("sidebar");
      if (sidebar && sidebar.classList.contains("open")) {
        closeSidebar();
      }
    }
  });

  // Animation du bouton de recherche
  const searchBtn = document.querySelector('.search-btn');
  if (searchBtn) {
    searchBtn.addEventListener('click', function(e) {
      e.preventDefault();
      this.style.transform = 'translateY(-50%) scale(0.9)';
      setTimeout(() => {
        this.style.transform = 'translateY(-50%) scale(1)';
      }, 150);
    });
  }

  // Fermer le dropdown des wilayas en cliquant √† l'ext√©rieur
  document.addEventListener('click', function(event) {
    if (!event.target.closest('.wilaya-dropdown-wrapper')) {
      const dropdown = document.getElementById('wilaya-dropdown-menu');
      const btn = document.querySelector('.wilaya-dropdown-btn');
      if (dropdown && btn) {
        dropdown.classList.remove('show');
        btn.classList.remove('open');
      }
    }
  });

  // Fermer le dropdown des cat√©gories en cliquant √† l'ext√©rieur
  document.addEventListener('click', function(event) {
    if (!event.target.closest('.category-dropdown-wrapper')) {
      const dropdown = document.getElementById('category-dropdown-menu');
      const btn = document.querySelector('.category-dropdown-btn');
      if (dropdown && btn) {
        dropdown.classList.remove('show');
        btn.classList.remove('open');
      }
    }
  });
}
</script>